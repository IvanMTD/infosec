<div class="container-fluid my-2">
    <div id="edit-modal-field"></div>
    <!-- Заголовок -->
    <div class="row pt-2">
        <div class="col">
            <h3 class="text-center">Справочник ФЦПСР</h3>
        </div>
    </div>
    <!-- Главная поисковая система -->
    <div class="row mx-0">
        <div class="d-grid col-12 col-md-6 col-lg-6 mx-auto my-2">
            <div class="row mx-0">
                <div class="col-10 px-0 form-floating">
                    <input type="text" class="form-control" id="global-search" list="global-list" placeholder="global-search" oninput="globalSearch()">
                    <datalist id="global-list"></datalist>
                    <label for="global-search" class="ms-2">Поиск</label>
                </div>
                <div class="col-2 px-0 d-flex">
                    <i class="fs-2 m-auto bi bi-search"></i>
                </div>
            </div>
        </div>
    </div>
    <!-- Ручной поиск и поле результатов -->
    <div class="row">
        <!-- d-none d-md-block -->
        <div class="col-sm-6 col-md-5 col-lg-5 mt-4 d-none d-md-block">
            <div class="row mx-2">
                <div class="col">
                    <div class="d-grid gap-2">
                        <button th:each="department, dps : ${guide.departments}" th:text="${department.title}" th:id="'btn-dep-' + ${dps.index}" th:my-data="${department.id}" class="btn btn-sm btn-outline-secondary department text-start" type="button" onclick="selectDepartment(this.id)"></button>
                        <script>
                            document.getElementById('btn-dep-0').setAttribute('class',"btn btn-sm btn-secondary department text-start")
                        </script>
                    </div>
                    <div class="row" th:if="${admin}">
                        <div class="col mt-2 d-flex">
                            <div class="btn-group mx-auto" role="group">
                                <button type="button" class="btn btn-outline-secondary" disabled><i class="bi bi-plus-square"></i></button>
                                <button type="button" class="btn btn-outline-secondary" disabled><i class="bi bi-pencil-square"></i></button>
                                <button type="button" class="btn btn-outline-secondary" disabled><i class="bi bi-trash"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div th:if="${guide.getDepartments().size()} != 0">
                        <div class="d-grid gap-2" id="division-grid">
                            <button th:each="division, dvs : ${guide.departments[0].divisions}" th:text="${division.title}" th:id="'btn-div-0-' + ${dvs.index}" th:my-data="${division.id}" class="btn btn-sm btn-outline-secondary division text-start" type="button" onclick="selectDivision(this.id)"></button>
                            <script>
                                document.getElementById('btn-div-0-0').setAttribute('class',"btn btn-sm btn-secondary division text-start")
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-md-7 col-lg-7 position-relative mt-4">
            <div class="row border border-dark img-bg rounded-3 h-100 mx-2">

                <div class="col">
                    <div id="guide-card-col" class="mb-5 pb-3">
                        <div th:if="${guide.getDepartments().size()} != 0">
                            <div th:if="${guide.getDepartments[0].getDivisions().size()} != 0">
                                <div th:if="${guide.departments[0].employees.size()} != 0">
                                    <div class="card mx-1 my-3 zoom" th:each="employee : ${guide.departments[0].divisions[0].employees}">
                                        <div class="row rounded-4 shadow m-2">
                                            <div class="col">
                                                <div class="row border-bottom">
                                                    <div class="col-sm-12 col-md-12 col-lg-12 m-0 p-1 my-auto">
                                                        <div class="m-0 p-1">
                                                            <b>
                                                                <p class="m-0 p-0 ps-2 text-sm-start text-md-center text-lg-center" th:text="${employee.position}"></p>
                                                            </b>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                                        <div class="m-0 p-1">
                                                            <p class="m-0 p-0 px-2" th:text="${employee.fullName}"></p>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                                        <div class="m-0 p-1">
                                                            <p class="m-0 p-0 px-2 text-sm-start text-md-center text-lg-center" th:text="${employee.email}"></p>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                                        <div class="m-0 p-1">
                                                            <p class="m-0 p-0 px-2 text-sm-start text-md-center text-lg-center text-secondary"><i style="font-size: 14px">8 (499) 550-94-74 — </i><span class="text-dark" th:text="${employee.phone}"></span></p>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                                        <div class="m-0 p-1">
                                                            <p class="m-0 p-0 px-2 user-select-none cursor-pointer blur text-sm-start text-md-end text-lg-end" th:text="${employee.personalPhone}"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row" th:if="${admin}">
                                                    <div class="col-sm-12 col-md-12 col-lg-12 d-flex bg-primary-subtle rounded-bottom-4" th:if="${admin}">
                                                        <div class="btn-group m-auto" role="group" aria-label="Basic outlined example">
                                                            <button type="button" th:id="'pin-out-' + ${employee.id}" class="btn btn-outline-secondary my-2" onclick="pinOut(this.id)"><i class="bi bi-pin-angle">Открепить</i></button>
                                                            <button type="button" th:id="'edit-' + ${employee.id}" class="btn btn-outline-secondary my-2" onclick="editEmployee(this.id)"><i class="bi bi-pencil">Редактор</i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="position-absolute bottom-0 end-0 rounded-4 border" style="margin-right: 30px; margin-bottom: 10px">
                <button type="button" class="btn btn-outline-secondary rounded-circle shadow m-1" data-bs-toggle="modal" data-bs-target="#person-modal" th:if="${admin}"><i class="bi bi-person-add"></i></button>
                <div class="modal fade" id="person-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-xl">
                        <form id="person-modal-form" class="modal-content" novalidate>
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Добавить сотрудника</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row pt-3">
                                    <div class="col">
                                        <input type="text" id="search-free-employees" class="form-control" list="free-employee-list" oninput="searchFreeEmployees()">
                                        <datalist id="free-employee-list"></datalist>
                                    </div>
                                    <div class="col-2">
                                        <button type="button" class="btn btn-outline-secondary w-100" onclick="setupEmployee()">Добавить</button>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-2">
                                        <div class="form-floating">
                                            <input type="number" class="form-control" id="number" placeholder="number" required>
                                            <label for="number">№</label>
                                            <div class="valid-feedback">
                                                Все хорошо
                                            </div>
                                            <div class="invalid-feedback">
                                                Укажите п/н
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="lastname" placeholder="lastname" required>
                                            <label for="lastname">Фамилия</label>
                                            <div class="valid-feedback">
                                                Все хорошо
                                            </div>
                                            <div class="invalid-feedback">
                                                Укажите фамилию
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="name" placeholder="name" required>
                                            <label for="name">Имя</label>
                                            <div class="valid-feedback">
                                                Все хорошо
                                            </div>
                                            <div class="invalid-feedback">
                                                Укажите имя
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="middleName" placeholder="middleName" required>
                                            <label for="middleName">Отчество</label>
                                            <div class="valid-feedback">
                                                Все хорошо
                                            </div>
                                            <div class="invalid-feedback">
                                                Укажите отчество
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row pt-3">
                                    <div class="col-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="location" placeholder="location" required>
                                            <label for="location">Расположение</label>
                                            <div class="valid-feedback">
                                                Все хорошо
                                            </div>
                                            <div class="invalid-feedback">
                                                Укажите расположение
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="office" placeholder="office" required>
                                            <label for="office">Кабинет</label>
                                            <div class="valid-feedback">
                                                Все хорошо
                                            </div>
                                            <div class="invalid-feedback">
                                                Укажите кабинет
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-floating">
                                            <input type="number" class="form-control" id="short-number" placeholder="short-number" required>
                                            <label for="short-number">Короткий номер</label>
                                            <div class="valid-feedback">
                                                Все хорошо
                                            </div>
                                            <div class="invalid-feedback">
                                                Укажите короткий номер
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row pt-3">
                                    <div class="col">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="position" placeholder="position" required>
                                            <label for="position">Должность</label>
                                            <div class="valid-feedback">
                                                Все хорошо
                                            </div>
                                            <div class="invalid-feedback">
                                                Укажите должность
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-floating">
                                            <input type="email" class="form-control" id="email" placeholder="email" required>
                                            <label for="email">@Mail</label>
                                            <div class="valid-feedback">
                                                Все хорошо
                                            </div>
                                            <div class="invalid-feedback">
                                                Укажите почту
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="personal-phone" placeholder="personal-phone" required>
                                            <label for="personal-phone">Личный телефон</label>
                                            <div class="valid-feedback">
                                                Все хорошо
                                            </div>
                                            <div class="invalid-feedback">
                                                Укажите личный телефон
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Отмена</button>
                                <button type="button" class="btn btn-outline-success" onclick="sendEmployeeData(null)">Добавить</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div id="user-ip" class="col d-flex">

            </div>
        </div>
        <script>
            $.ajax({
                url:'/api/service/get/ip',
                type:'get',
                success: function (ip){
                    $('#user-ip').empty();
                    $('#user-ip').append(
                        '<div class="ms-auto">' +
                        '   <small id="user-ip" class="text-secondary">' + ip + '</small>' +
                        '</div>'
                    );
                }
            });
        </script>
    </div>
</div>

<script>
    const modal = document.getElementById('person-modal');

    modal.addEventListener('hidden.bs.modal', function () {
        const form = document.getElementById('person-modal-form');
        form.reset();
        form.classList.remove('was-validated');
    });

    document.querySelectorAll('.blur');
</script>

<script th:inline="javascript">
    let departments = [[${guide}]].departments;
    let admin = [[${admin}]];
    function selectDepartment(buttonId){
        let data = buttonId.split('-');
        let id = data[data.length - 1];
        let department = departments[id];
        let divisions = department.divisions;

        let activeButtons = document.querySelectorAll('.department');
        activeButtons.forEach(function(button) {
            button.setAttribute('class', 'btn btn-sm btn-outline-secondary department text-start');
        });

        let selectedButton = document.getElementById(buttonId);
        selectedButton.setAttribute('class','btn btn-sm btn-secondary department text-start');

        let count = 0;
        $('#division-grid').empty();
        divisions.forEach(function (division){
            $('#division-grid').append(
                '<button id="btn-div-' + id + '-' + count + '" my-data="' + division.id + '" class="btn btn-sm btn-outline-secondary division text-start" type="button" onclick="selectDivision(this.id)">' + division.title + '</button>'
            );
            count++;
        });

        $('#guide-card-col').empty();
        department.employees.forEach(function (employee){
            employeeAppend(employee);
        });
    }

    function selectDivision(buttonId){
        let parts = buttonId.split('-');
        let departmentId = parts[parts.length-2];
        let divisionId = parts[parts.length-1];
        let department = departments[departmentId];
        let division = department.divisions[divisionId];

        let activeButtons = document.querySelectorAll('.division');
        activeButtons.forEach(function(button) {
            button.setAttribute('class', 'btn btn-sm btn-outline-secondary division text-start');
        });

        let selectedButton = document.getElementById(buttonId);
        selectedButton.setAttribute('class','btn btn-sm btn-secondary division text-start');

        $('#guide-card-col').empty();
        division.employees.forEach(function (employee){
            employeeAppend(employee);
        });
    }

    function sendEmployeeData(employeeData){
        let structData = getCurrentSelectedData();
        console.log(structData);

        let request = null;

        if(employeeData != null){
            request = {
                id: employeeData.id,
                number: employeeData.number,
                lastname: employeeData.lastname,
                name: employeeData.name,
                middleName: employeeData.middleName,
                location: employeeData.address,
                office: employeeData.cabinet,
                shortNumber: employeeData.phone,
                personalPhone: employeeData.personalPhone,
                position: employeeData.position,
                email: employeeData.email,
                department: structData.department,
                division: structData.division
            }
            console.log(request);
        }else {

            const form = document.getElementById('person-modal-form');
            if (!form.checkValidity()) {
                // Пометить неверные поля как invalid
                form.classList.add('was-validated');
                return;
            }

            request = {
                id: 0,
                number: $('#number').val(),
                lastname: $('#lastname').val(),
                name: $('#name').val(),
                middleName: $('#middleName').val(),
                location: $('#location').val(),
                office: $('#office').val(),
                shortNumber: $('#short-number').val(),
                personalPhone: $('#personal-phone').val(),
                position: $('#position').val(),
                email: $('#email').val(),
                department: structData.department,
                division: structData.division
            }
        }

        console.log(request);

        let csrf = [[${_csrf}]];
        let header = csrf.headerName;
        let token = csrf.token;

        $.ajax({
            url: '/api/add/employee',
            method:'POST',
            data: JSON.stringify(request),
            contentType:'application/json',
            beforeSend: function(xhr) {
                xhr.setRequestHeader(header, token);
            },
            success: function (response){
                if(request.division != 0){
                    departments[structData.departmentIndex].divisions[structData.divisionIndex].employees.push(response);
                }else{
                    departments[structData.departmentIndex].employees.push(response);
                }
                employeeAppend(response);
                $('#person-modal').modal('hide');
            }
        });

    }

    function searchFreeEmployees(){
        let query = $('#search-free-employees').val();
        $.ajax({
            url:'/api/search/free/employees',
            type:'get',
            data: {
                query: query
            },
            success: function (response){
                let datalist = $('#free-employee-list');
                datalist.empty();
                response.forEach(function (employee){
                    datalist.append(
                        '<option value="' + employee.fullName + '" my-data="' + JSON.stringify(employee).replace(/"/g, '&quot;') + '"></option>'
                    );
                });
            }
        });
    }

    function setupEmployee(){
        let employeeSearch = document.getElementById('search-free-employees').value;
        let dataList = document.getElementById('free-employee-list').options;
        for(let i=0; i<dataList.length; i++){
            if(dataList[i].value === employeeSearch){
                let employee = JSON.parse(dataList[i].getAttribute('my-data').replace(/&quot;/g, '"'));
                sendEmployeeData(employee);
            }
        }
    }

    function getCurrentSelectedData(){
        let selectedButtons = document.querySelectorAll('button.btn-secondary');
        let departmentButton = selectedButtons[0];
        let depParts = departmentButton.id.split('-');
        let depIndex = depParts[depParts.length - 1];
        let divisionButton = selectedButtons[1];
        let departmentId = departmentButton.getAttribute('my-data');
        let divisionId = 0;
        let divIndex = null;
        if(divisionButton !== undefined){
            let divParts = divisionButton.id.split('-');
            divIndex = divParts[divParts.length - 1];
            divisionId = divisionButton.getAttribute('my-data');
        }
        return {
            departmentIndex: depIndex,
            department: departmentId,
            divisionIndex: divIndex,
            division: divisionId
        }
    }

    function pinOut(buttonId){
        let parts = buttonId.split('-');
        let id = parts[parts.length -1];
        let structure = getCurrentSelectedData();
        $.ajax({
            url:'/api/pinout/employee',
            type:'get',
            data:{
                employeeId:id
            },
            success: function (response){
                if(structure.division != 0){
                    let employees = departments[structure.departmentIndex].divisions[structure.divisionIndex].employees;
                    let employeeIndex = null;
                    for(let i=0; i<employees.length; i++){
                        if(employees[i].id == response.id){
                            employeeIndex = i;
                        }
                    }
                    departments[structure.departmentIndex].divisions[structure.divisionIndex].employees.splice(employeeIndex,1);
                    employees = departments[structure.departmentIndex].divisions[structure.divisionIndex].employees;
                    rebuildEmployees(employees);
                }else{
                    let employees = departments[structure.departmentIndex].employees;
                    let employeeIndex = null;
                    for(let i=0; i<employees.length; i++){
                        if(employees[i].id == response.id){
                            employeeIndex = i;
                        }
                    }
                    departments[structure.departmentIndex].employees.splice(employeeIndex,1);
                    employees =departments[structure.departmentIndex].employees;
                        rebuildEmployees(employees);
                }
            }
        });
    }

    function editEmployee(buttonId){
        let parts = buttonId.split('-');
        let id = parts[parts.length - 1];
        let employee = findEmployeeById(departments,id);
        showEmployeeModal(employee);
    }

    function findEmployeeById(departments, id) {
        id = parseInt(id);
        for (let department of departments) {
            // Проверяем сотрудников в департаменте
            let employee = department.employees.find(emp => emp.id === id);
            if (employee) return employee;

            // Проверяем сотрудников в подразделениях департамента
            for (let division of department.divisions) {
                employee = division.employees.find(emp => emp.id === id);
                if (employee) return employee;
            }
        }
        // Если сотрудник не найден, возвращаем null или undefined
        return null;
    }

    function showEmployeeModal(employee){
        let modal = $('#edit-modal-field');
        modal.empty();
        modal.append(`
            <div class="modal fade" id="employee-edit-modal" tabindex="-1" aria-labelledby="employee-edit-label" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Редактор - ${employee.fullName}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row g-2">
                                <div class="col-sm-12 col-md-3 col-lg-3 form-floating">
                                    <input type="number" class="form-control" id="employee-number" placeholder="employee-number" value="${employee.number}">
                                    <label for="employee-number" class="ms-2">№</label>
                                </div>
                                <div class="col-sm-12 col-md-3 col-lg-3 form-floating">
                                    <input type="text" class="form-control" id="employee-lastname" placeholder="employee-lastname" value="${employee.lastname}">
                                    <label for="employee-lastname" class="ms-2">Фамилия</label>
                                </div>
                                <div class="col-sm-12 col-md-3 col-lg-3 form-floating">
                                    <input type="text" class="form-control" id="employee-name" placeholder="employee-name" value="${employee.name}">
                                    <label for="employee-name" class="ms-2">Имя</label>
                                </div>
                                <div class="col-sm-12 col-md-3 col-lg-3 form-floating">
                                    <input type="text" class="form-control" id="employee-middle-name" placeholder="employee-middle-name" value="${employee.middleName}">
                                    <label for="employee-middle-name" class="ms-2">Отчество</label>
                                </div>
                            </div>
                            <div class="row pt-2 g-2">
                                <div class="col-sm-12 col-md-3 col-lg-3 form-floating">
                                    <input type="text" class="form-control" id="employee-address" placeholder="employee-address" value="${employee.address}">
                                    <label for="employee-address" class="ms-2">Расположение</label>
                                </div>
                                <div class="col-sm-12 col-md-3 col-lg-3 form-floating">
                                    <input type="text" class="form-control" id="employee-cabinet" placeholder="employee-cabinet" value="${employee.cabinet}">
                                    <label for="employee-cabinet" class="ms-2">Кабинет</label>
                                </div>
                                <div class="col-sm-12 col-md-3 col-lg-3 form-floating">
                                    <input type="text" class="form-control" id="employee-phone" placeholder="employee-phone" value="${employee.phone}">
                                    <label for="employee-phone" class="ms-2">Короткий номер</label>
                                </div>
                                <div class="col-sm-12 col-md-3 col-lg-3 form-floating">
                                    <input type="text" class="form-control" id="employee-personal-phone" placeholder="employee-personal-phone" value="${employee.personalPhone}">
                                    <label for="employee-personal-phone" class="ms-2">Персональный номер</label>
                                </div>
                            </div>
                            <div class="row pt-2 g-2">
                                <div class="col-sm-12 col-md-6 col-lg-6 form-floating">
                                    <input type="text" class="form-control" id="employee-position" placeholder="employee-position" value="${employee.position}">
                                    <label for="employee-position" class="ms-2">Должность</label>
                                </div>
                                <div class="col-sm-12 col-md-6 col-lg-6 form-floating">
                                    <input type="email" class="form-control" id="employee-email" placeholder="employee-email" value="${employee.email}">
                                    <label for="employee-email" class="ms-2">@Mail</label>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Закрыть</button>
                            <button type="button" class="btn btn-outline-primary" onclick="updateEmployee(${employee.id})">Обновить</button>
                        </div>
                    </div>
                </div>
            </div>
        `);

        let employeeEditModal = new bootstrap.Modal(document.getElementById('employee-edit-modal'));
        employeeEditModal.show();
    }

    function updateEmployee(id){
        let employee = {
            id: id,
            number: $('#employee-number').val(),
            lastname: $('#employee-lastname').val(),
            name: $('#employee-name').val(),
            middleName: $('#employee-middle-name').val(),
            address: $('#employee-address').val(),
            cabinet: $('#employee-cabinet').val(),
            phone: $('#employee-phone').val(),
            personalPhone: $('#employee-personal-phone').val(),
            position: $('#employee-position').val(),
            email: $('#employee-email').val()
        };

        // тут должна быть еще проверка

        $.ajax({
            url:'/api/auth/employee/update',
            type:'get',
            data:employee,
            success:function (response){
                location.reload(true);
            }
        });
    }


    function globalSearch(){
        let search = $('#global-search').val();
        if(search === ''){
            $('#guide-card-col').empty();
        }else{
            $.ajax({
                url:'/api/search/employees',
                type:'get',
                data:{
                    search:search
                },
                success: function (response){
                    rebuildEmployees(response);
                }
            });
        }
    }

    function rebuildEmployees(employees){
        $('#guide-card-col').empty();
        employees.forEach(function(employee){
            employeeAppend(employee);
        })
    }

    function employeeAppend(employee){
        if(admin){
            let cardBody = `
            <div class="card mx-1 my-3 zoom">
                <div class="row rounded-4 shadow m-2">
                    <div class="col">
                        <div class="row border-bottom">
                            <div class="col-sm-12 col-md-12 col-lg-12 m-0 p-1 my-auto">
                                <div class="m-0 p-1">
                                    <p class="m-0 p-0 text-sm-start text-md-center text-lg-center ps-2"><b>${employee.position}</b></p>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                <div class="m-0 p-1">
                                    <p class="m-0 p-0 px-2">${employee.fullName}</p>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                <div class="m-0 p-1">
                                    <p class="m-0 p-0 px-2 text-sm-start text-md-center text-lg-center">${employee.email}</p>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                <div class="m-0 p-1">
                                    <p class="m-0 p-0 px-2 text-sm-start text-md-center text-lg-center text-secondary"><i style="font-size: 14px">8 (499) 550-94-74 — </i><span class="text-dark">${employee.phone}</span></p>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                <div class="m-0 p-1">
                                    <p class="m-0 p-0 px-2 user-select-none cursor-pointer blur text-sm-start text-md-end text-lg-end">${employee.personalPhone}</p>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12 col-md-12 col-lg-12 d-flex bg-primary-subtle rounded-bottom-4">
                                <div class="btn-group m-auto" role="group" aria-label="Basic outlined example">
                                    <button type="button" id="pin-out-${employee.id}" class="btn btn-outline-secondary my-2" onclick="pinOut(this.id)"><i class="bi bi-pin-angle">Открепить</i></button>
                                    <button type="button" id="edit-${employee.id}" class="btn btn-outline-secondary my-2" onclick="editEmployee(this.id)"><i class="bi bi-pencil">Редактор</i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            `
            $('#guide-card-col').append(cardBody);
        }else{
            let cardBody = `
            <div class="card mx-1 my-3 zoom">
                <div class="row rounded-4 shadow m-2">
                    <div class="col">
                        <div class="row border-bottom">
                            <div class="col-sm-12 col-md-12 col-lg-12 m-0 p-1 my-auto">
                                <div class="m-0 p-1">
                                    <b><p class="m-0 p-0 text-sm-start text-md-center text-lg-center ps-2">${employee.position}</p></b>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                <div class="m-0 p-1">
                                    <p class="m-0 p-0 px-2">${employee.fullName}</p>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                <div class="m-0 p-1">
                                    <p class="m-0 p-0 px-2 text-sm-start text-md-center text-lg-center">${employee.email}</p>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                <div class="m-0 p-1">
                                    <p class="m-0 p-0 px-2 text-sm-start text-md-center text-lg-center text-secondary"><i style="font-size: 14px">8 (499) 550-94-74 — </i><span class="text-dark">${employee.phone}</span></p>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-3 col-lg-3 m-0 p-1 my-auto">
                                <div class="m-0 p-1">
                                    <p class="m-0 p-0 px-2 user-select-none cursor-pointer blur text-sm-start text-md-end text-lg-end">${employee.personalPhone}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            `
            $('#guide-card-col').append(cardBody);
        }
    }
</script>